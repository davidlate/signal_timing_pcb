set(srcs "main.c" "stp_sd_sdcardops.c" "stp_audio__audio_ops.c" "stp_adc.c")

idf_component_register(SRCS ${srcs}
                       INCLUDE_DIRS "."
                       REQUIRES fatfs sd_card esp_timer esp_driver_i2s bootloader_support esp_adc esp_driver_gptimer esp_driver_ledc esp_driver_rmt esp_driver_ledc
                       WHOLE_ARCHIVE)


target_include_directories(${COMPONENT_LIB} SYSTEM PRIVATE
  ${IDF_PATH}/components
)

#Compiler flags partially generated by AI
target_compile_options(${COMPONENT_LIB} PRIVATE
  # ---------- shared (C + C++) ----------

  -fsanitize=undefined
  -fno-sanitize=shift-base

  
  -Wall
  -Wextra
  -Werror
  -Wformat=2
  -Wformat-overflow=2
  -Wpedantic
  -Wformat-truncation
  -Wshadow
  -Wconversion
  #-Wundef
  -Wimplicit-fallthrough
  -Wmissing-attributes
  -Wmisleading-indentation
  -Wreturn-type
  -Wmismatched-dealloc
  -Wreturn-mismatch
  -Wdangling-pointer=2
  -Wparentheses
  -Wuse-after-free=3
  -Wdouble-promotion
  -Wnull-dereference
  -Wswitch-enum
  -Wdangling-else
  -Wmissing-braces
  -Wswitch-default
  -Wuninitialized
  -Wmaybe-uninitialized
  -Wpointer-arith
  -Wcast-align=strict
  -Wcast-qual

  # ---------- C-only (safe now, won’t break later C++) ----------
#   $<$<COMPILE_LANGUAGE:C>:
#     -Wstrict-prototypes
#     -Wmissing-prototypes
#     -Wold-style-definition
#   >

  # ---------- “very strict” (enable when you’re ready; noisy) ----------
  # $<$<COMPILE_LANGUAGE:C,CXX>:
  #   -Wconversion
  #   -Wsign-conversion
  #   -Wstrict-overflow=5
  #   -Wduplicated-cond
  #   -Wduplicated-branches
  # >
)